<div class="p-1">
    <mat-card>
        <mat-card-header>
            <mat-card-title>{{(id) ? 'Edit' : 'Add New'}} Product</mat-card-title>
        </mat-card-header>
        <mat-card-content>



            <mat-accordion>
                <!-- #docregion basic-panel -->
                <!-- #docregion hide-toggle -->
                <mat-expansion-panel hideToggle [expanded]="step === 0" (opened)="setStep(0)" hideToggle>

                    <mat-expansion-panel-header>
                        <mat-panel-title>
                        </mat-panel-title>
                        <mat-panel-description>
                            {{cateTot}}
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <!-- aqui va el contenido del priomer exopancion panel -->
                    <mat-toolbar color="primary">
                        <button mat-icon-button>
                            <mat-icon>home</mat-icon>
                        </button>
                        <div> Selecciona tu Categoria</div>
                        <div fxFlex style="margin:auto;"></div>
                        <button mat-icon-button matTooltip="Clear all steps" (click)="onRemoveAll()">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </mat-toolbar>
                    <mat-horizontal-stepper [linear]="true" #stepper (selectionChange)="onStepChange($event)">
                        <mat-step *ngFor="let step of newSteps; let i = index">
                            <ng-template matStepLabel>{{step.title || 'Elige una Categoria!'}} <mat-icon
                                    style="vertical-align:middle" (click)="stepSeleccionado($event,i)">trending_flat
                                </mat-icon>
                            </ng-template>
                            <mat-radio-group class="example-radio-group" (change)="changeStep($event, i)">
                                <mat-radio-button class="example-radio-button" *ngFor="let option of categoriasLista"
                                    [value]="option.nivelcategoria">
                                    {{option.descCategoria}}
                                </mat-radio-button>
                            </mat-radio-group>
                        </mat-step>
                        <mat-step>
                            <ng-template matStepLabel>

                            </ng-template>
                        </mat-step>
                    </mat-horizontal-stepper>
                    <mat-action-row>
                        <!--<button mat-button color="primary" (click)="nextStep()">Next</button>-->
                    </mat-action-row>
                </mat-expansion-panel>



                <!-- #enddocregion basic-panel -->
                <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)" hideToggle [disabled]="true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Ingresa la Información de tu producto
                        </mat-panel-title>
                        <mat-panel-description>
                            {{panelOpenState ? '' : ''}}
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <!-- aqui va el contenido del segundo exopancion panel -->
                    <form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off" fxLayout="row wrap">
                        <div fxFlex="40" class="px-2">
                            <p class="mt-1"><span class="uppercase fw-500">Galleria de Fotos</span><span
                                    class="text-muted px-1">(max 8 imagenes)</span></p>
                            <input-file [(ngModel)]="file" formControlName="images" fileLimit="8" fileAccept="image/*">
                            </input-file>
                            <div fxLayout="row wrap">
                                <div fxFlex="100" class="mt-2 text-center w-100">
                                    <button type='button' mat-raised-button
                                        style="float: right; border: outset rgb(1, 177, 247);margin-right: 30px;"
                                        class="mat-focus-indicator mat-accent compose-dialog-button w-20-p mat-raised-button mat-button-base"
                                        aria-label [disabled]="!file" (click)="upLoad()">
                                        Subir Archivo
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div fxFlex="60" class="px-2">
                            <div fxLayout="row wrap">
                                <div fxFlex="100" fxFlex.gt-sm="50" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Nombre Del Producto</mat-label>
                                        <input matInput formControlName="name" required>
                                        <mat-error *ngIf="form.controls.name.errors?.required">El nombre del producto es
                                            Obligatorio
                                        </mat-error>
                                        <mat-error *ngIf="form.controls.name.hasError('minlength')">El nombre no puede
                                            tener menos de 4 caratcteres</mat-error>
                                    </mat-form-field>
                                </div>

                                <div fxFlex="100" fxFlex.gt-sm="50" class="px-1">                                  
                                        <input matInput formControlName="categoryId" required  style="display: none;">                                     
                                </div>

                                <div fxFlex="100" fxFlex.gt-sm="50" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Precio Anterior</mat-label>
                                        <input matInput formControlName="oldPrice" type="number" min="1">
                                        <mat-error *ngIf="form.controls.oldPrice.errors?.required">El precio anterior es requerido!
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="100" fxFlex.gt-sm="50" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Nuevo Precio</mat-label>
                                        <input matInput formControlName="newPrice" type="number" min="1" required>
                                        <mat-error *ngIf="form.controls.newPrice.errors?.required">El precio nuevo es requerido!
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="100" fxFlex.gt-sm="50" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Descuento (%)</mat-label>
                                        <input matInput formControlName="discount" type="number" min="0" pattern="^[0-9]+">
                                    </mat-form-field>
                                </div>
                                <div fxFlex="100" fxFlex.gt-sm="50" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Cantidad de productos disponibles</mat-label>
                                        <input matInput formControlName="availibilityCount" type="number" min="1" pattern="^[0-9]+">
                                    </mat-form-field>
                                </div>

                                <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Color</mat-label>
                                        <mat-select formControlName="color" multiple
                                            (selectionChange)="onColorSelectionChange($event)">
                                            <mat-select-trigger>{{selectedColors}}</mat-select-trigger>
                                            <mat-option *ngFor="let color of colors" [value]="color">
                                                <div fxLayout="row" fxLayoutAlign="space-between center">
                                                    <span>{{color}}</span>
                                                    <mat-icon [style.color]="color">fiber_manual_record</mat-icon>
                                                </div>
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Tamaño</mat-label>
                                        <mat-select formControlName="size" multiple>
                                            <mat-option *ngFor="let size of sizes" [value]="size">
                                                <span>{{size}}</span>
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="100" fxFlex.gt-sm="33.3" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Peso (Kg)</mat-label>
                                        <input matInput formControlName="weight" type="number" min="0" >
                                    </mat-form-field>
                                </div>

                                <div fxFlex="100" class="px-1">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <mat-label>Descrión del producto</mat-label>
                                        <textarea matInput formControlName="description" rows="7"></textarea>
                                    </mat-form-field>
                                </div>

                                <div fxFlex="100" class="mt-2 text-center w-100">
                                    <button mat-raised-button color="primary" type="submit" [disabled]="!unlock">Guardar</button>
                                </div>
                            </div>
                        </div>
                    </form>
                    <mat-action-row>
                        <button mat-button color="warn" (click)="prevStep()">Regresar</button>
                    </mat-action-row>
                    <!-- aqui cierra el form y el panel expandible-->
                </mat-expansion-panel>


            </mat-accordion>
        </mat-card-content>
    </mat-card>
</div>